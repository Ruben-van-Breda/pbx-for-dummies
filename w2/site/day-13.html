<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Week 2 ‚Äî Day 13: Monitoring & Troubleshooting</title>
  <link rel="stylesheet" href="./site.css" />
</head>
<body>
  <main class="lesson">
    <header>
      <nav class="nav-top">
        <a href="./day-12.html">‚Üê Previous</a>
        <a href="./index.html">Back to Week 2</a>
        <a href="./day-14.html">Next ‚Üí</a>
      </nav>
      <h1>Day 13 ‚Äî Monitoring & Troubleshooting</h1>
    </header>
    <section class="content">
      <h2>Objectives</h2>
      <ul>
        <li>Analyze SIP/RTP traffic</li>
        <li>Generate and read CDRs</li>
      </ul>

      <h2>Concepts (Explained)</h2>
      <ul>
        <li>SIP logging to pinpoint failures (4xx/5xx)</li>
        <li>RTP inspection: jitter/loss and one-way audio diagnosis</li>
        <li>CDRs for accounting and debugging</li>
      </ul>

      <h2>Steps (15‚Äì20 min)</h2>
      <ol>
        <li>In Asterisk CLI:
<pre><code>pjsip set logger on
core set verbose 5</code></pre>
        </li>
        <li>Make a test call; note responses and any errors</li>
        <li>In Wireshark: Telephony ‚Üí VoIP Calls ‚Üí Flow Sequence</li>
        <li>Review CDR output (CSV/db depending on config)</li>
      </ol>

      <h2>Quick Check (Self-test)</h2>
      <ul>
        <li>Where would you look first for one-way audio?</li>
        <li>Which SIP response classes indicate client vs server errors?</li>
      </ul>

      <h2>Common Pitfalls</h2>
      <ul>
        <li>Wrong capture interface or filter</li>
        <li>SRTP media undecodable</li>
        <li>Too short captures for intermittent issues</li>
        <li>Low verbosity/log rotation</li>
        <li>Missing NTP/time sync</li>
      </ul>

      <h2>üìö Further Reading & References</h2>
      <ul>
        <li><a href="https://www.wireshark.org/docs/wsug_html_chunked/ChTel.html" target="_blank" rel="noopener noreferrer">Wireshark: VoIP Analysis</a></li>
        <li><a href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+CLI" target="_blank" rel="noopener noreferrer">Asterisk CLI Reference</a></li>
        <li><a href="https://wiki.asterisk.org/wiki/display/AST/Call+Detail+Records" target="_blank" rel="noopener noreferrer">Asterisk CDRs</a></li>
        <li><a href="https://www.voip-info.org/one-way-audio/" target="_blank" rel="noopener noreferrer">One-way Audio Troubleshooting</a></li>
      </ul>

      <h2>Deliverable</h2>
      <ul>
        <li>Files: <code>day13_troubleshooting_log.md</code>, optional <code>day13_call_capture.pcapng</code></li>
        <li>Notes: Root cause identified and steps to resolve</li>
        <li>Goal: A repeatable approach to isolate signaling vs media problems</li>
      </ul>

      <h2 id="appendix-deep-dives">Appendix ‚Äî Deep Dives</h2>

      <h3>Deep Dive: SIP Error Taxonomy and Triage Flow</h3>
      <ul>
        <li>4xx client vs 5xx server vs 6xx global; map common codes (403/404/408/486/488/500/503).</li>
        <li>Triage: signaling ok but no media ‚Üí inspect SDP, NAT, RTP ports.</li>
      </ul>

      <h3>Deep Dive: RTP/RTCP Analysis for One‚ÄëWay and Choppy Audio</h3>
      <ul>
        <li>Check symmetric flow, SSRC/ports, seq numbers; use RTCP stats when SRTP hides payload.</li>
        <li>Targets: low jitter on wired; confirm DSCP/QoS; validate firewall/NAT pinholes.</li>
      </ul>

      <h3>Deep Dive: Logging Strategy and Reproducible Test Cases</h3>
      <ul>
        <li>Persist logs; capture environment (IPs, codecs, versions); red/green tests to prove fixes.</li>
      </ul>

      <hr />

      <div class="quiz-controls">
        <button id="start-quiz" type="button">Start Quiz</button>
      </div>
      <div id="quiz" hidden>
        <h2>‚úÖ Quiz ‚Äî Day 13 (Deep Dives, 10 Questions + Answers)</h2>
        <ol>
          <li>Which CLI commands enable useful SIP debug in Asterisk?
            <ul><li>Answer: <code>pjsip set logger on</code> and <code>core set verbose 5</code>.</li></ul>
          </li>
          <li>Where would you look first for one-way audio?
            <ul><li>Answer: NAT/firewall and SDP/RTP address/port settings.</li></ul>
          </li>
          <li>What Wireshark view shows call flows end-to-end?
            <ul><li>Answer: Telephony ‚Üí VoIP Calls ‚Üí Flow Sequence.</li></ul>
          </li>
          <li>What are CDRs used for?
            <ul><li>Answer: Accounting and troubleshooting.</li></ul>
          </li>
          <li>Why are short captures risky for intermittent issues?
            <ul><li>Answer: They may miss the failure condition.</li></ul>
          </li>
          <li>How do SRTP calls appear in Wireshark?
            <ul><li>Answer: RTP payload undecodable; rely on RTCP, ports, timing.</li></ul>
          </li>
          <li>What response classes indicate client vs server errors in SIP?
            <ul><li>Answer: 4xx client; 5xx server.</li></ul>
          </li>
          <li>Name one cause of missing packets in captures.
            <ul><li>Answer: Wrong interface/filter.</li></ul>
          </li>
          <li>Why is NTP important for troubleshooting?
            <ul><li>Answer: Time sync enables accurate correlation of logs and packets.</li></ul>
          </li>
          <li>What should a troubleshooting log include?
            <ul><li>Answer: Symptoms, hypotheses, tests, evidence, root cause, fix.</li></ul>
          </li>
        </ol>
      </div>

      <style>
      .quiz-modal[hidden]{display:none}
      .quiz-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:999}
      .quiz-modal .overlay{position:absolute;inset:0;background:rgba(0,0,0,.55)}
      .quiz-modal .dialog{position:relative;background:var(--panel);border:1px solid #2a323c;border-radius:12px;max-width:640px;width:92%;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.6)}
      .quiz-modal header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
      .quiz-modal header h3{margin:0}
      .quiz-modal .flashcard{background:#0f1318;border:1px solid #2a323c;border-radius:10px;padding:16px;min-height:140px}
      .quiz-modal .label{color:var(--muted);font-size:.9rem;margin-bottom:6px}
      .quiz-modal .text{white-space:pre-wrap}
      .quiz-modal .note{margin-top:10px;width:100%;min-height:80px;background:#0f1318;border:1px solid #2a323c;border-radius:8px;color:var(--text);padding:8px}
      .quiz-modal footer{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}
      .quiz-modal button{background:var(--card);border:1px solid #2a323c;border-radius:10px;padding:8px 12px;color:var(--text)}
      </style>

      <div id="quiz-modal" class="quiz-modal" hidden>
        <div class="overlay" data-close="1"></div>
        <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="quiz-title">
          <header>
            <h3 id="quiz-title">Day 13 ‚Äî Quiz</h3>
            <button id="quiz-close" type="button" aria-label="Close">‚úï</button>
          </header>
          <div class="flashcard">
            <div id="flashcard-label" class="label">Question</div>
            <div id="flashcard-text" class="text"></div>
          </div>
          <textarea id="quiz-note" class="note" placeholder="Optional: jot your answer..."></textarea>
          <footer>
            <button id="quiz-back" type="button">Back</button>
            <button id="quiz-next" type="button">Next</button>
          </footer>
        </div>
      </div>

      <script>
      (function(){
        var quizContainer = document.getElementById('quiz');
        var startBtn = document.getElementById('start-quiz');
        var modal = document.getElementById('quiz-modal');
        var closeBtn = document.getElementById('quiz-close');
        var nextBtn = document.getElementById('quiz-next');
        var backBtn = document.getElementById('quiz-back');
        var labelEl = document.getElementById('flashcard-label');
        var textEl = document.getElementById('flashcard-text');
        var noteEl = document.getElementById('quiz-note');

        if(!quizContainer) return;

        var qa = [];
        var items = quizContainer.querySelectorAll('ol > li');
        items.forEach(function(li){
          var q = '';
          li.childNodes.forEach(function(node){ if(node.nodeType === Node.TEXT_NODE){ q += node.textContent; } });
          q = (q||'').trim().replace(/^\d+\)\s*/, '');
          var aEl = li.querySelector('ul li');
          var a = aEl ? aEl.textContent.replace(/^Answer:\s*/,'').trim() : '';
          if(q){ qa.push({q:q, a:a}); }
        });

        var idx = 0; var showingAnswer = false; var notes = qa.map(function(){return '';});
        function render(){
          if(!qa.length) return;
          var item = qa[idx];
          if(showingAnswer){ labelEl.textContent = 'Answer'; textEl.textContent = item.a || '(No answer provided)'; }
          else { labelEl.textContent = 'Question'; textEl.textContent = item.q; }
          if(noteEl){ noteEl.value = notes[idx] || ''; }
        }
        function openModal(){ idx=0; showingAnswer=false; render(); modal.removeAttribute('hidden'); }
        function closeModal(){ if(noteEl){ notes[idx]=noteEl.value; } modal.setAttribute('hidden',''); }
        function next(){ if(!qa.length) return; if(noteEl){ notes[idx]=noteEl.value; }
          if(!showingAnswer){ showingAnswer=true; render(); } else { showingAnswer=false; idx=(idx+1)%qa.length; render(); } }
        function back(){ if(!qa.length) return; if(noteEl){ notes[idx]=noteEl.value; }
          if(showingAnswer){ showingAnswer=false; render(); } else { idx=(idx-1+qa.length)%qa.length; showingAnswer=false; render(); } }
        if(startBtn) startBtn.addEventListener('click', openModal);
        if(closeBtn) closeBtn.addEventListener('click', closeModal);
        if(nextBtn) nextBtn.addEventListener('click', next);
        if(backBtn) backBtn.addEventListener('click', back);
        modal.addEventListener('click', function(e){ if(e.target && e.target.getAttribute('data-close')) closeModal(); });
        document.addEventListener('keydown', function(e){ if(!modal.hasAttribute('hidden') && e.key==='Escape') closeModal(); });
      })();
      </script>
    </section>
  </main>
</body>
</html>

